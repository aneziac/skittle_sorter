#include <Arduino_KNN.h>

const int sample_count = 16;
const float calib_array[6][sample_count][3] = {
  {
    {213, 172, 293},
    {188, 142, 249},
    {205, 162, 279},
    {183, 137, 241},
    {203, 161, 277},
    {214, 173, 295},
    {226, 183, 310},
    {200, 147, 262},
    {224, 176, 304},
    {237, 190, 326}
  },
  {
    {191, 146, 304},
    {177, 139, 268},
    {196, 157, 298},
    {187, 137, 263},
    {193, 151, 287},
    {194, 159, 297},
    {181, 133, 255},
    {200, 162, 315}
  },
  {
    {190, 131, 218},
    {181, 119, 207},
    {179, 132, 223},
    {182, 134, 223},
    {172, 118, 206},
    {179, 126, 214},
    {184, 137, 228},
    {208, 158, 264},
    {203, 147, 247},
    {208, 163, 270}
  },
  {
    {159, 126, 216},
    {148, 113, 197},
    {152, 125, 211},
    {152, 126, 213},
    {157, 119, 208},
    {158, 129, 220},
    {160, 138, 231},
    {170, 145, 242},
    {159, 126, 216},
    {178, 146, 248},
    {179, 154, 258}
  },
  {
    {281, 132, 242},
    {230, 123, 226},
    {250, 136, 245},
    {281, 132, 242},
    {230, 123, 226},
    {250, 136, 245},
    {264, 137, 247},
    {213, 120, 219},
    {233, 138, 243},
    {244, 154, 269},
    {257, 168, 290}
  },
  {
    {328, 156, 371},
    {218, 131, 264},
    {247, 143, 296},
    {291, 142, 330},
    {226, 128, 268},
    {254, 142, 299},
    {255, 148, 306},
    {308, 160, 353},
    {255, 159, 312},
    {281, 175, 346}
  }
};

KNNClassifier color_KNN(3);

void read_calibration_data() {
  for (int i = 0; i < 5; i++) {
    for (int j = 0; j < sample_count; j++) {
      color_KNN.addExample(calib_array[i][j], i);
    }
    Serial.print("Calibrated "); Serial.println(i);
  }
  return;
}

void setup() {
    Serial.begin(9600);
    Serial.println("Starting...");
    read_calibration_data();    
    Serial.println("Complete");
    float color_vec[3] = {282, 222, 361};
    Serial.println(color_KNN.classify(color_vec, 6));
}

void loop() {
  while(1);
}
